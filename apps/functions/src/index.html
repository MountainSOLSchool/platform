<body>
    <script>
        function downloadBlob(blob, name = 'file.txt') {
            if (window.navigator && window.navigator.msSaveOrOpenBlob)
                return window.navigator.msSaveOrOpenBlob(blob);

            // For other browsers:
            // Create a link pointing to the ObjectURL containing the blob.
            const data = window.URL.createObjectURL(blob);

            const link = document.createElement('a');
            link.href = data;
            link.download = name;

            // this is necessary as link.click() does not work on the latest firefox
            link.dispatchEvent(
                new MouseEvent('click', {
                    bubbles: true,
                    cancelable: true,
                    view: window,
                })
            );

            setTimeout(() => {
                // For Firefox it is necessary to delay revoking the ObjectURL
                window.URL.revokeObjectURL(data);
                link.remove();
            }, 100);
        }

        const downloadReport = () => {
            const downloadButton = document.querySelector('#downloadBtn');
            downloadButton.innerText = 'Downloading...';
            downloadButton.disabled = true;
            fetch(
                'http://localhost:5001/mountain-sol-platform/us-central1/roster?class=' +
                    document.querySelector('#classNameInput').value
            )
                .then((response) => response.json())
                .then(({ data }) => {
                    const spreadsheetFile = new Blob([new Uint8Array(data)], {
                        type: 'application/pdf',
                    });
                    downloadBlob(spreadsheetFile, 'roster.pdf');
                    downloadButton.innerText = 'Download Report';
                    downloadButton.disabled = false;
                });
        };
    </script>
    <label for="classNameInput">Class Name</label>
    <input id="classNameInput" placeholder="Knots-fall-2021" />
    <button id="downloadBtn" onclick="downloadReport()">Download Report</button>
</body>
