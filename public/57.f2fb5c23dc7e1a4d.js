"use strict";(self.webpackChunkportal=self.webpackChunkportal||[]).push([[57],{7057:(io,E,s)=>{s.r(E),s.d(E,{ReportComponentModule:()=>so});var M=s(6666),b=s(9808),I=s(6115),h=s(7579),U=s(1135),B=s(4782),w=s(3900),A=s(4128),z=s(8996),R=s(4004),$=s(9718),x=s(8675),J=s(3028),K=s(5665),r=s(5620);const v=(0,r.R7)({source:"Report component",events:{"Download forms intent":(0,r.Ky)(),"Copy emails intent":(0,r.Ky)()}}),p=(0,r.R7)({source:"Report effects",events:{"Started downloading forms":(0,r.Ky)(),"Finished downloading forms":(0,r.Ky)(),"Failed downloading forms":(0,r.Ky)(),"Started downloading class emails":(0,r.Ky)(),"Finished downloading class emails":(0,r.Ky)(),"Failed downloading class emails":(0,r.Ky)()}}),D=(0,r.Tz)({name:"reportComponentFeature",reducer:(0,r.Lq)({inProgressClassFormDownloads:{},inProgressCopyClassEmails:{}},(0,r.on)(p.startedDownloadingForms,(t,{className:e})=>Object.assign(Object.assign({},t),{inProgressClassFormDownloads:Object.assign(Object.assign({},t.inProgressClassFormDownloads),{[e]:!0})})),(0,r.on)(p.finishedDownloadingForms,(t,{className:e})=>Object.assign(Object.assign({},t),{inProgressClassFormDownloads:Object.assign(Object.assign({},t.inProgressClassFormDownloads),{[e]:!1})})),(0,r.on)(p.startedDownloadingClassEmails,(t,{className:e})=>Object.assign(Object.assign({},t),{inProgressCopyClassEmails:Object.assign(Object.assign({},t.inProgressCopyClassEmails),{[e]:!0})})),(0,r.on)(p.finishedDownloadingClassEmails,(t,{className:e})=>Object.assign(Object.assign({},t),{inProgressCopyClassEmails:Object.assign(Object.assign({},t.inProgressCopyClassEmails),{[e]:!1})})))});var o=s(5e3),Z=s(1485),y=s(9962),j=s(9783),T=s(845);function H(t,e){1&t&&(o.TgZ(0,"tr")(1,"th",5),o._uU(2," Name "),o._UZ(3,"p-sortIcon",6),o.qZA(),o.TgZ(4,"th",7),o._uU(5," # Enrolled Students "),o._UZ(6,"p-sortIcon",8),o.qZA(),o._UZ(7,"th",9)(8,"th",10),o.qZA())}function Q(t,e){if(1&t){const n=o.EpF();o.TgZ(0,"tr")(1,"td"),o._uU(2),o.qZA(),o.TgZ(3,"td"),o._uU(4),o.qZA(),o.TgZ(5,"td")(6,"p-button",11),o.NdJ("click",function(){const d=o.CHM(n).$implicit;return o.oxw(2).downloadClick(d.title)}),o.qZA()(),o.TgZ(7,"td")(8,"p-button",12),o.NdJ("click",function(){const d=o.CHM(n).$implicit;return o.oxw(2).copyEmailsClick(d.title)}),o.qZA()()()}if(2&t){const n=e.$implicit,i=o.oxw().ngIf;o.xp6(2),o.Oqu(n.title),o.xp6(2),o.Oqu(n.enrolledCount),o.xp6(2),o.Q6J("id",n.id+"downloadBtn")("loading",i.isClassFormDownloadInProgress[n.title]),o.xp6(2),o.Q6J("id",n.id+"emailsBtn")("loading",i.isClassSignInFormDownloadsInProgress[n.title])}}const W=function(){return[]};function Y(t,e){if(1&t&&(o.TgZ(0,"p-table",2),o.ALo(1,"async"),o.ALo(2,"async"),o.YNc(3,H,9,0,"ng-template",3),o.YNc(4,Q,9,6,"ng-template",4),o.qZA()),2&t){const n=o.oxw();let i;o.Q6J("value",null!==(i=null==(i=o.lcZ(1,2,n.classes$))?null:i.classes)&&void 0!==i?i:o.DdM(6,W))("loading",null===o.lcZ(2,4,n.classes$))}}const P=function(){return{}},X=function(t,e){return{isClassFormDownloadInProgress:t,isClassSignInFormDownloadsInProgress:e}},N=[{path:"",component:(()=>{class t{constructor(n,i){this.functionsApi=n,this.store=i,this.uploadClick$=new h.x,this.selectedClass$=new U.X(void 0),this.classNameInput$=new h.x,this.reportNameKeydown$=new h.x,this.emailClick$=new h.x,this.classes$=this.functionsApi.call("classes").pipe((0,B.d)(1)),this.isUploading$=this.uploadClick$.pipe((0,w.w)(({files:l})=>(0,A.D)(l.map(d=>(0,z.D)(d.text()).pipe((0,R.U)(a=>{const c=new Map;return J.parse(a,{header:!0,transform:m=>{var u;return null!==(u=null==m?void 0:m.trim())&&void 0!==u?u:""},transformHeader:m=>{var u;const O=K.N[m],S=null!==(u=c.get(m))&&void 0!==u?u:0,eo="string"==typeof O?O:O[S];return c.set(m,S+1),eo}}).data})))).pipe((0,R.U)(d=>d.reduce((a,c)=>[...a,...c],[])),(0,w.w)(d=>this.functionsApi.call("importStudentEnrollmentSummer2022",d).pipe((0,$.h)(!1))),(0,x.O)(!0))))}ngOnInit(){this.isClassFormDownloadInProgress$=this.store.select(D.selectInProgressClassFormDownloads),this.isClassSignInFormDownloadsInProgress$=this.store.select(D.selectInProgressCopyClassEmails)}copyEmailsClick(n){this.store.dispatch(v.copyEmailsIntent({className:n}))}downloadClick(n){this.store.dispatch(v.downloadFormsIntent({className:n}))}}return t.\u0275fac=function(n){return new(n||t)(o.Y36(Z.O),o.Y36(r.yh))},t.\u0275cmp=o.Xpm({type:t,selectors:[["ng-component"]],decls:6,vars:10,consts:[[2,"margin-top","20px"],["responsiveLayout","scroll","sortMode","single",3,"value","loading",4,"ngIf"],["responsiveLayout","scroll","sortMode","single",3,"value","loading"],["pTemplate","header"],["pTemplate","body"],["pSortableColumn","title",2,"width","40%"],["field","title"],["pSortableColumn","enrolledCount"],["field","enrolledCount"],[2,"width","20%"],[2,"width","15%"],["label","View/Print Class Forms","icon","pi pi-download",1,"sol-button",3,"id","loading","click"],["label","Copy Email Lists",1,"sol-button",3,"id","loading","click"]],template:function(n,i){if(1&n&&(o.TgZ(0,"h1"),o._uU(1,"Class Forms and Contacts"),o.qZA(),o.TgZ(2,"div",0),o.YNc(3,Y,5,7,"p-table",1),o.ALo(4,"async"),o.ALo(5,"async"),o.qZA()),2&n){let l;o.xp6(3),o.Q6J("ngIf",o.WLB(7,X,null!==(l=o.lcZ(4,1,i.isClassFormDownloadInProgress$))&&void 0!==l?l:o.DdM(5,P),null!==(l=o.lcZ(5,3,i.isClassSignInFormDownloadsInProgress$))&&void 0!==l?l:o.DdM(6,P)))}},directives:[b.O5,y.iA,j.jx,y.lQ,y.fz,T.zx],pipes:[b.Ov],encapsulation:2,changeDetection:0}),t})(),children:[]}];let V=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[[I.Bz.forChild(N)],I.Bz]}),t})();var L,k=s(1424),q=s(2145),_=s(8205),oo=s(8185),g=s(4394),F=s(8505),to=s(9287);class f{constructor(e,n,i,l,d){this.actions$=e,this.store=n,this.functionsApi=i,this.clipboard=l,this.messageService=d,L.add(this),this.downloadClassForms$=(0,g.GW)(()=>this.actions$.pipe((0,g.l4)(v.downloadFormsIntent),(0,w.w)(({className:a})=>(0,A.D)([this.functionsApi.call(`roster?class=${a}`).pipe((0,F.b)(({html:c})=>{const C=window.open("",`${a} Roster`,`toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=${screen.width/2},height=${screen.height},top=0,left=0`);C&&(C.document.body.innerHTML=c)})),this.functionsApi.call(`signIn?class=${a}`).pipe((0,F.b)(({html:c})=>{const C=window.open("",`${a} Sign In/Out`,`toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=${screen.width/2},height=${screen.height},top=0,left=${screen.width/2}`);C&&(C.document.body.innerHTML=c)}))]).pipe((0,$.h)(p.finishedDownloadingForms({className:a})),(0,x.O)(p.startedDownloadingForms({className:a})))))),this.copyClassEmails$=(0,g.GW)(()=>this.actions$.pipe((0,g.l4)(v.copyEmailsIntent),(0,w.w)(({className:a})=>this.functionsApi.call(`emails?class=${a}`).pipe((0,R.U)(({list:c})=>c.join(", ")),(0,F.b)(c=>this.clipboard.copy(c)),(0,$.h)(p.finishedDownloadingClassEmails({className:a})),(0,F.b)(()=>this.messageService.add({summary:`Copied emails for ${a}!`,severity:"success"})),(0,x.O)(p.startedDownloadingClassEmails({className:a}))))))}}L=new WeakSet,f.\u0275fac=function(e){return new(e||f)(o.LFG(g.eX),o.LFG(r.yh),o.LFG(Z.O),o.LFG(to.TU),o.LFG(j.ez))},f.\u0275prov=o.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"});let so=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[[b.ez,M.B,V,T.hJ,k.j,q.WN,_.O,oo.q,y.U$,r.Aw.forFeature(D),g.sQ.forFeature([f])]]}),t})()}}]);