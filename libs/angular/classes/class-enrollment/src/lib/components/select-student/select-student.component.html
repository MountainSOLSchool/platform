<ng-container *rxLet="viewModel$; let vm">
    <div *rxIf="!vm.showAsReadonlyBlock; else readonlyExplanation">
        Select a student to enroll.
    </div>
    <ng-template #readonlyExplanation>
        <div style="margin-bottom: 1rem">
            In order to change the student you are enrolling, you must start
            over.
        </div>
        <button
            style="margin-bottom: 2rem"
            pButton
            label="Start Over"
            (click)="startOverIntent()"
        ></button>
    </ng-template>
    <div class="mt-4 flex flex-wrap gap-3">
        @if (vm.students === undefined) {
            <p-card
                [style]="{
                    width: '16rem',
                    height: '20rem',
                    margin: 'auto'
                }"
            >
                <div style="display: flex; align-items: center; gap: 10px">
                    <p-progressSpinner
                        [style]="{ width: '20px', height: '20px' }"
                    ></p-progressSpinner>
                    <p>Loading previously enrolled students...</p>
                </div>
            </p-card>
        } @else {
            @for (student of vm.students; track student) {
                <div
                    [ngStyle]="{
                        border:
                            student.id === vm.selectedStudentId
                                ? '.2rem solid #3c82f7'
                                : '.2rem solid transparent',
                        'border-radius': '6px',
                        'box-sizing': 'border-box',
                        height: 'fit-content'
                    }"
                >
                    <p-card
                        [header]="student.name"
                        [style]="{
                            width: '16rem',
                            height: '20rem',
                            margin: 'auto'
                        }"
                    >
                        <ng-template pTemplate="subHeader">
                            <h3>Birthday</h3>
                            <p>{{ student.birthday }}</p>
                        </ng-template>
                        <ng-template pTemplate="footer">
                            <button
                                pButton
                                class="w-full mt-3"
                                [disabled]="vm.showAsReadonlyBlock"
                                [ngClass]="{
                                    'p-button-outlined':
                                        vm.selectedStudentId !== student.id
                                }"
                                [label]="
                                    vm.selectedStudentId === student.id
                                        ? 'Selected'
                                        : 'Select'
                                "
                                (click)="selectedStudent(student.id)"
                            ></button>
                        </ng-template>
                    </p-card>
                </div>
            }
        }
        <div
            [ngStyle]="{
                border:
                    vm.selectedStudentType === 'new'
                        ? '.2rem solid #3c82f7'
                        : '.2rem solid transparent',
                'border-radius': '6px',
                'box-sizing': 'border-box',
                height: 'fit-content'
            }"
        >
            <p-card
                header="New Student"
                [style]="{
                    width: '16rem',
                    height: '20rem'
                }"
            >
                <div class="w-full flex justify-content-center">
                    <div>
                        <span style="font-size: 6rem" class="pi pi-user"></span>
                    </div>
                </div>

                <ng-template pTemplate="footer">
                    <button
                        pButton
                        [disabled]="vm.showAsReadonlyBlock"
                        [ngClass]="{
                            'w-full': true,
                            'mt-3': true,
                            'p-button-outlined':
                                vm.selectedStudentType !== 'new'
                        }"
                        [label]="
                            vm.selectedStudentType === 'new'
                                ? 'Selected'
                                : 'Select'
                        "
                        (click)="selectedStudentType('new')"
                    ></button>
                </ng-template>
            </p-card>
        </div>
    </div>
</ng-container>

<p-dialog
    header="Start over?"
    *rxLet="showStartOverModal$; let showStartOverModal"
    [visible]="showStartOverModal"
    [closable]="false"
    [modal]="true"
    [draggable]="false"
    (onHide)="canceledChange$.next(undefined)"
>
    <div style="margin-top: 1rem">
        Starting over the selected student will cause you to lose any new or
        updated information you've entered on the subsequent steps. Are you sure
        you want to start over and change students?
    </div>
    <div style="margin-top: 1rem">
        <button
            pButton
            class="p-button-danger"
            label="Yes, Start Over"
            (click)="confirmStartOver()"
        ></button>
        <button
            pButton
            label="No, Cancel"
            style="margin-left: 1rem"
            (click)="canceledChange$.next(undefined)"
        ></button>
    </div>
</p-dialog>
