<mat-stepper
    [linear]="true"
    [orientation]="(stepperOrientation | async)!"
    #workflowStepper
>
    <mat-step #classSelection label="Class Selection" [completed]="false">
        <ng-template matStepContent>
            <sol-class-picker
                (validityChange)="classSelection.completed = $event"
            ></sol-class-picker>
            <ng-container
                *ngTemplateOutlet="navigation; context: { first: true }"
            ></ng-container
        ></ng-template>
    </mat-step>
    <mat-step #studentInfo label="Student Info" [completed]="false">
        <ng-template matStepContent>
            <sol-student-info
                (validityChange)="studentInfo.completed = $event"
            ></sol-student-info>
            <ng-container *ngTemplateOutlet="navigation"></ng-container>
        </ng-template>
    </mat-step>
    <mat-step #account label="Account" [completed]="false">
        <ng-template matStepContent>
            <sol-class-account
                (validityChange)="account.completed = $event"
            ></sol-class-account>

            <ng-container *ngTemplateOutlet="navigation"></ng-container
        ></ng-template>
    </mat-step>
    <mat-step #paymentMethod label="Payment Method" [completed]="false">
        <ng-template matStepContent>
            <sol-checkout
                #checkout
                (validityChange)="paymentMethod.completed = $event"
            ></sol-checkout>
            <ng-container
                *ngTemplateOutlet="
                    navigation;
                    context: { readyForNext: checkout.validatePaymentMethod }
                "
            ></ng-container
        ></ng-template>
    </mat-step>
    <mat-step #confirmation label="Confirm Enrollment" [completed]="false">
        <ng-template matStepContent>
            <sol-class-confirmation
                (validityChange)="confirmation.completed = $event"
            ></sol-class-confirmation>
            <ng-container
                *ngTemplateOutlet="navigation; context: { last: true }"
            ></ng-container
        ></ng-template>
    </mat-step>

    <ng-template
        #navigation
        let-first="first"
        let-last="last"
        let-readyForNext="readyForNext"
    >
        <div style="margin-top: 2rem">
            <button
                *ngIf="!first"
                pButton
                matStepperPrevious
                class="p-button-outlined"
            >
                Previous
            </button>
            <ng-container *ngIf="!last; else submit">
                <button
                    *ngIf="!readyForNext; else handleReadyForNext"
                    pButton
                    matStepperNext
                    style="margin-left: 1rem"
                >
                    Next
                </button>
                <ng-template #handleReadyForNext>
                    <button
                        pButton
                        style="margin-left: 1rem"
                        (click)="
                            readyForNext() ? next(workflowStepper) : undefined
                        "
                    >
                        Next
                    </button></ng-template
                >
            </ng-container>
            <ng-template #submit>
                <button pButton style="margin-left: 1rem">
                    Submit
                </button></ng-template
            >
        </div>
    </ng-template>
</mat-stepper>
