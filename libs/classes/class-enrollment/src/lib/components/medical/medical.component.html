<p-accordion *rxLet="viewModel$; let vm">
    <p-accordionTab [selected]="true">
        <ng-template pTemplate="header">
            <div
                *rxLet="!vm.hasErrorsByGroup['contacts']; let valid"
                [solValid]="valid"
            >
                Emergency Contacts<ng-container *ngIf="!valid">
                    ⚠️</ng-container
                >
            </div>
        </ng-template>
        <form>
            <div class="p-fluid">
                <h3>Emergency Contacts</h3>
                <p>
                    Please list two relatives, friends or neighbors that you
                    have notified and who have agreed to assume temporary care
                    of your child if you cannot be reached.
                </p>

                <div
                    *ngFor="
                        let contact of vm.student.emergencyContacts;
                        let i = index;
                        trackBy: trackByIndex;
                        let last = last
                    "
                    style="margin-bottom: 1rem"
                    [ngStyle]="{
                        'border-bottom': last ? 'none' : '1px solid lightgray'
                    }"
                >
                    <div class="formgrid grid">
                        <div
                            class="field col"
                            *rxLet="'contact_' + i + '_name'; let fieldname"
                        >
                            <span class="p-float-label">
                                <input
                                    type="text"
                                    [id]="fieldname"
                                    [name]="fieldname"
                                    pInputText
                                    [solValid]="!vm.errors[fieldname]"
                                    [(ngModel)]="contact.name"
                                    (ngModelChange)="
                                        updateStudentMedicalInfo(vm.student)
                                    "
                                />
                                <label [for]="fieldname">Name</label>
                            </span>
                            <sol-messages
                                [messages]="vm.errors[fieldname]"
                            ></sol-messages>
                        </div>
                        <div
                            class="field col"
                            *rxLet="
                                'contact_' + i + '_relationship';
                                let fieldname
                            "
                        >
                            <span class="p-float-label">
                                <input
                                    type="text"
                                    [id]="fieldname"
                                    [name]="fieldname"
                                    pInputText
                                    [solValid]="!vm.errors[fieldname]"
                                    [(ngModel)]="contact.relationship"
                                    (ngModelChange)="
                                        updateStudentMedicalInfo(vm.student)
                                    "
                                />
                                <label [for]="fieldname"
                                    >Relationship to Student</label
                                >
                            </span>
                            <sol-messages
                                [messages]="vm.errors[fieldname]"
                            ></sol-messages>
                        </div>
                        <div
                            class="field col"
                            *rxLet="'contact_' + i + '_phone'; let fieldname"
                        >
                            <span class="p-float-label">
                                <p-inputMask
                                    type="text"
                                    [id]="fieldname"
                                    [name]="fieldname"
                                    mask="999-999-9999"
                                    [solValid]="!vm.errors[fieldname]"
                                    [(ngModel)]="contact.phone"
                                    (ngModelChange)="
                                        updateStudentMedicalInfo(vm.student)
                                    "
                                ></p-inputMask>
                                <label [for]="fieldname">Phone Number</label>
                            </span>
                            <sol-messages
                                [messages]="vm.errors[fieldname]"
                            ></sol-messages>
                        </div>
                    </div>
                    <div
                        *ngIf="i > 1"
                        style="width: 10rem; margin-bottom: 1rem"
                    >
                        <button
                            label="Remove"
                            type="button"
                            pRipple
                            pButton
                            class="p-button-outlined p-button-danger"
                            (click)="removeContact(i)"
                        ></button>
                    </div>
                </div>

                <div style="width: 20%; padding-bottom: 20px">
                    <button
                        pButton
                        type="button"
                        label="Add Emergency Contact"
                        class="p-button-outlined"
                        (click)="addContact()"
                    ></button>
                </div>
            </div>
        </form>
    </p-accordionTab>

    <p-accordionTab>
        <ng-template pTemplate="header">
            <div
                *rxLet="!vm.hasErrorsByGroup['health']; let valid"
                [solValid]="valid"
            >
                Student Health Information<ng-container *ngIf="!valid">
                    ⚠️</ng-container
                >
            </div>
        </ng-template>
        <form>
            <div class="p-fluid">
                <h3>Student Information</h3>
                <div class="formgrid grid">
                    <div class="field col">
                        <span class="p-float-label">
                            <input
                                required
                                type="text"
                                id="weight"
                                name="weight"
                                pInputText
                                [solValid]="!vm.errors['weight']"
                                [(ngModel)]="vm.student.weightImperial"
                                (ngModelChange)="
                                    updateStudentMedicalInfo(vm.student)
                                "
                                [ngModelOptions]="{ updateOn: 'blur' }"
                            />
                            <label for="weight">Child's Weight</label>
                        </span>
                        <sol-messages
                            [messages]="vm.errors['weight']"
                        ></sol-messages>
                    </div>
                    <div class="field col">
                        <span class="p-float-label">
                            <input
                                required
                                type="text"
                                id="height"
                                name="height"
                                pInputText
                                [solValid]="!vm.errors['height']"
                                [(ngModel)]="vm.student.heightImperial"
                                (ngModelChange)="
                                    updateStudentMedicalInfo(vm.student)
                                "
                                [ngModelOptions]="{ updateOn: 'blur' }"
                            />
                            <label for="height">Child's Height</label>
                        </span>
                        <sol-messages
                            [messages]="vm.errors['height']"
                        ></sol-messages>
                    </div>
                </div>

                <h3>Primary Physician</h3>

                <div class="formgrid grid">
                    <div class="field col">
                        <span class="p-float-label">
                            <input
                                required
                                type="text"
                                id="docName"
                                name="docName"
                                pInputText
                                [solValid]="!vm.errors['doctorName']"
                                [(ngModel)]="vm.student.doctorName"
                                (ngModelChange)="
                                    updateStudentMedicalInfo(vm.student)
                                "
                                [ngModelOptions]="{ updateOn: 'blur' }"
                            />
                            <label for="docName">Doctor's Name</label>
                        </span>
                        <sol-messages
                            [messages]="vm.errors['doctorName']"
                        ></sol-messages>
                    </div>
                    <div class="field col">
                        <span class="p-float-label">
                            <p-inputMask
                                type="text"
                                id="docPhone"
                                name="docPhone"
                                mask="999-999-9999"
                                [solValid]="!vm.errors['doctorPhone']"
                                [(ngModel)]="vm.student.doctorPhone"
                                (ngModelChange)="
                                    updateStudentMedicalInfo(vm.student)
                                "
                                [ngModelOptions]="{ updateOn: 'blur' }"
                            ></p-inputMask>
                            <label for="docPhone">Doctor's Phone</label>
                        </span>
                        <sol-messages
                            [messages]="vm.errors['doctorPhone']"
                        ></sol-messages>
                    </div>
                </div>

                <h3>Insurance Information</h3>
                <p>If you have insurance, please add it here.</p>
                <div class="formgrid grid">
                    <div class="field col">
                        <span class="p-float-label">
                            <input
                                required
                                type="text"
                                id="insuranceCo"
                                name="insuranceCo"
                                pInputText
                                [solValid]="!vm.errors['insuranceCompany']"
                                [(ngModel)]="vm.student.insuranceCompany"
                                (ngModelChange)="
                                    updateStudentMedicalInfo(vm.student)
                                "
                                [ngModelOptions]="{ updateOn: 'blur' }"
                            />
                            <label for="insuranceCo">Insurance Company</label>
                        </span>
                        <sol-messages
                            [messages]="vm.errors['insuranceCompany']"
                        ></sol-messages>
                    </div>

                    <div class="field col">
                        <span class="p-float-label">
                            <input
                                type="text"
                                id="insuranceNo"
                                name="insuranceNo"
                                pInputText
                                [solValid]="!vm.errors['insuranceId']"
                                [(ngModel)]="vm.student.insuranceId"
                                (ngModelChange)="
                                    updateStudentMedicalInfo(vm.student)
                                "
                                [ngModelOptions]="{ updateOn: 'blur' }"
                            />
                            <label for="insuranceNo"
                                >Medical Insurance ID Number</label
                            >
                        </span>
                        <sol-messages
                            [messages]="vm.errors['insuranceId']"
                        ></sol-messages>
                    </div>
                </div>

                <h3>Allergies</h3>
                <p>
                    Please be specific about any allergies the child has and
                    list the protocols for each allergy, especially if the
                    allergy requires an Epi-Pen (or similar). Be sure to check
                    the box below if the student has any allergies that are
                    life-threatening.
                </p>
                <div style="width: 40%">
                    <p-toggleButton
                        id="lifeThreateningAllergy"
                        name="lifeThreateningAllergy"
                        onLabel="My child has a life-threatening allergy"
                        offLabel="My child does not have a life-threatening allergy"
                        onIcon="pi pi-check"
                        offIcon="pi pi-times"
                        [(ngModel)]="vm.student.hasLifeThreateningAllergies"
                    ></p-toggleButton>
                </div>
                <div id="allergies" class="field">
                    <span class="p-float-label">
                        <textarea
                            id="allergies"
                            name="allergies"
                            [rows]="5"
                            [cols]="50"
                            pInputTextarea
                            [autoResize]="true"
                            [(ngModel)]="vm.student.allergies"
                            (ngModelChange)="
                                updateStudentMedicalInfo(vm.student)
                            "
                            [ngModelOptions]="{ updateOn: 'blur' }"
                        ></textarea>
                        <label for="allergies">Allergies (Optional)</label
                        ><br /><br />
                    </span>
                </div>

                <h3>Medications</h3>
                <p>
                    If your child routinely takes medication, please fill out
                    the following, even if the medication is not dispensed
                    during Mountain SOL programs. Any medication needed during
                    the program should be given to a designated staff member and
                    will be dispensed by the designated staff member. Please
                    list the following information for each medication.
                </p>

                <div
                    *ngFor="
                        let medication of vm.student.medications;
                        let i = index;
                        trackBy: trackByIndex;
                        let last = last
                    "
                    style="margin-bottom: 1rem"
                    [ngStyle]="{
                        'border-bottom': last ? 'none' : '1px solid lightgray'
                    }"
                >
                    <div class="formgrid grid">
                        <div
                            class="field col"
                            *rxLet="'medication_' + i + '_name'; let fieldname"
                        >
                            <span class="p-float-label">
                                <input
                                    type="text"
                                    [id]="fieldname"
                                    [name]="fieldname"
                                    pInputText
                                    [solValid]="!vm.errors[fieldname]"
                                    [(ngModel)]="medication.name"
                                    (ngModelChange)="
                                        updateStudentMedicalInfo(vm.student)
                                    "
                                />
                                <label [for]="fieldname">Medication Name</label>
                            </span>
                            <sol-messages
                                [messages]="vm.errors[fieldname]"
                            ></sol-messages>
                        </div>
                        <div
                            class="field col"
                            *rxLet="
                                'medication_' + i + '_dosage';
                                let fieldname
                            "
                        >
                            <span class="p-float-label">
                                <input
                                    type="text"
                                    [id]="fieldname"
                                    [name]="fieldname"
                                    pInputText
                                    [solValid]="!vm.errors[fieldname]"
                                    [(ngModel)]="medication.dosage"
                                    (ngModelChange)="
                                        updateStudentMedicalInfo(vm.student)
                                    "
                                />
                                <label [for]="fieldname">Dosage</label>
                            </span>
                            <sol-messages
                                [messages]="vm.errors[fieldname]"
                            ></sol-messages>
                        </div>
                        <div
                            class="field col"
                            *rxLet="
                                'medication_' + i + '_doctor';
                                let fieldname
                            "
                        >
                            <span class="p-float-label">
                                <input
                                    type="text"
                                    [id]="fieldname"
                                    [name]="fieldname"
                                    pInputText
                                    [solValid]="!vm.errors[fieldname]"
                                    [(ngModel)]="medication.doctor"
                                    (ngModelChange)="
                                        updateStudentMedicalInfo(vm.student)
                                    "
                                />
                                <label [for]="fieldname">Doctor</label>
                            </span>
                            <sol-messages
                                [messages]="vm.errors[fieldname]"
                            ></sol-messages>
                        </div>
                    </div>
                    <div style="width: 10rem; margin-bottom: 1rem">
                        <button
                            label="Remove"
                            type="button"
                            pRipple
                            pButton
                            class="p-button-outlined p-button-danger"
                            (click)="removeMedication(i)"
                        ></button>
                    </div>
                </div>

                <div style="width: 20%; padding-bottom: 20px">
                    <button
                        pButton
                        type="button"
                        label="Add Medication"
                        class="p-button-outlined"
                        (click)="addMedication()"
                    ></button>
                </div>

                <div id="Privacy" style="padding-bottom: 20px">
                    <h3>Medical Authorization</h3>
                    <p>
                        Do you authorize Mountain SOL Staff to assist in the
                        dispensing of medication including epi-pen and inhalers,
                        as prescribed above?
                    </p>
                    <p-selectButton
                        [options]="medicationAuth"
                        name="authorizedToAdministerMedication"
                        optionLabel="name"
                        optionValue="value"
                        [solValid]="
                            !vm.errors['authorizedToAdministerMedication']
                        "
                        [(ngModel)]="
                            vm.student.authorizedToAdministerMedication
                        "
                        (ngModelChange)="updateStudentMedicalInfo(vm.student)"
                    ></p-selectButton>
                    <sol-messages
                        [messages]="
                            vm.errors['authorizedToAdministerMedication']
                        "
                    ></sol-messages>
                </div>

                <h3>Additional Notes about the Student</h3>
                <p>
                    Please list any other physical conditions that may affect
                    your child's participation in our programs. Please also
                    describe any behavioral or circumstantial conditions that
                    staff should be aware of, especially if they might affect
                    their participation in the program. Are there certain things
                    that would be helpful to know about your child?
                </p>
                <div id="healthNotes" class="field">
                    <span class="p-float-label">
                        <textarea
                            id="healthNotes"
                            name="healthNotes"
                            [rows]="5"
                            [cols]="50"
                            pInputTextarea
                            [autoResize]="true"
                        ></textarea>
                        <label for="healthNotes"
                            >Additional Health or Medical Notes
                            (Optional)</label
                        ><br /><br />
                    </span>
                </div>
            </div>
        </form>
    </p-accordionTab>
    <p-accordionTab>
        <ng-template pTemplate="header">
            <div
                *rxLet="!vm.hasErrorsByGroup['healthRelease']; let valid"
                [solValid]="valid"
            >
                Medical Release and Permission to Treat<ng-container
                    *ngIf="!valid"
                >
                    ⚠️</ng-container
                >
            </div>
        </ng-template>
        <form>
            <div class="p-fluid">
                <p>
                    My child is in good physical and mental health. I have
                    listed any special health considerations.
                </p>

                <p>
                    I acknowledge that acceptance of my child to the program
                    with my child's special health considerations is at the
                    discretion of Mountain SOL School. In case of emergency, I
                    understand that every effort will be made to contact parents
                    or guardians of children. In the event I cannot be reached
                    within a reasonable time, I grant permission to the
                    physician selected by Mountain SOL staff to hospitalize,
                    secure treatment for and to order injection, anesthesia or
                    surgery for the child as named herein.
                </p>
            </div>
            <div style="width: 60%">
                <p-toggleButton
                    id="studentLivesWith"
                    name="studentLivesWith"
                    onLabel="I hereby certify that the above information is correct."
                    offLabel="I do not agree"
                    onIcon="pi pi-check"
                    offIcon="pi pi-times"
                    [solValid]="!vm.errors['signedMedicalRelease']"
                    [(ngModel)]="vm.student.signedMedicalRelease"
                    (ngModelChange)="updateStudentMedicalInfo(vm.student)"
                ></p-toggleButton>
                <sol-messages
                    [messages]="vm.errors['signedMedicalRelease']"
                ></sol-messages>
            </div>
        </form>
    </p-accordionTab>
    <p-accordionTab>
        <ng-template pTemplate="header">
            <div
                *rxLet="!vm.hasErrorsByGroup['liabilityRelease']; let valid"
                [solValid]="valid"
            >
                Release of Liability and Hold Harmless<ng-container
                    *ngIf="!valid"
                >
                    ⚠️</ng-container
                >
            </div>
        </ng-template>
        <form>
            <div class="p-fluid">
                <p>
                    I authorize my child to participate in the program and any
                    associated transportation services provided by Mountain SOL
                    School or its agents.
                </p>

                <p>
                    I acknowledge that I am the only one who can determine if I
                    or my child is physically fit enough or adequately skilled
                    enough to participate in the program.
                </p>

                <p>
                    I acknowledge the inherent risks that may result from by
                    child's participation in the program including falls,
                    fractures, contraction of infectious diseases, misbehavior
                    of other children, etc., all of which may result in injury
                    or death to my child or damage to his/her/our property. I
                    further acknowledge that Mountain SOL School is neither a
                    common carrier nor in the business of providing
                    transportation services to the public. I expressly assume
                    these risks and any associated costs, damages or losses,
                    including those caused by simple negligence of Mountain SOL
                    School, and waive and fully release all claims held by me,
                    my spouse/partner, my child or any of our estates from and
                    against Mountain SOL School and its agency partners,
                    officers, board members, agents, employees, volunteers and
                    representatives, arising from my child's attendance and
                    participation in the program and accept full responsibility
                    for the cost of all medical treatment to my child as a
                    result of any injuries caused by or through such other
                    risks. This waiver and release will apply to any and all
                    actions, causes, damages, claims or demands of any kind,
                    whether known or unknown, arising out of or otherwise
                    incidental to participation in the program.
                </p>

                <p>
                    I further agree, on behalf of myself and/or my child, to
                    indemnify, defend and hold harmless Mountain SOL School and
                    its agency partners, officers, board members, agents,
                    employees, volunteers and representatives from any injuries,
                    liabilities, claims, damages and expenses, including
                    attorney fees, incurred by Mountain SOL School, me, my child
                    or on behalf of my child, arising from my child's attendance
                    and participation in the program, with the exception of
                    gross negligence or reckless misconduct of Mountain SOL
                    School. While participating in the program, I and my child
                    will obey all rules, regulations and laws of the State of
                    West Virginia and the United States. I and my child will
                    further obey all rules, regulations and policies of Mountain
                    SOL School associated with the program.
                </p>

                <p>
                    I acknowledge that my or my child's failure to comply with
                    these rules, regulations, policies and laws may result in my
                    or my child's expulsion from the program. I agree that this
                    release will be governed by the laws of the State of West
                    Virginia. If any provision of this release is found to be
                    invalid or unenforceable, then the remainder of this release
                    will have full force and effect, and the invalid provision
                    will be modified, or partially enforced, to the maximum
                    extent permitted by West Virginia State law.
                </p>
            </div>

            <div style="width: 60%">
                <p-toggleButton
                    id="studentLivesWith"
                    name="studentLivesWith"
                    onLabel="I hereby certify that this information is correct. I have read all of the above terms and conditions, and I understand and agree to be bound by them."
                    offLabel="I do not agree"
                    onIcon="pi pi-check"
                    offIcon="pi pi-times"
                    [solValid]="!vm.errors['signedReleaseOfLiability']"
                    [(ngModel)]="vm.student.signedReleaseOfLiability"
                    (ngModelChange)="updateStudentMedicalInfo(vm.student)"
                ></p-toggleButton>
                <sol-messages
                    [messages]="vm.errors['signedReleaseOfLiability']"
                ></sol-messages>
            </div>
        </form>
    </p-accordionTab>
</p-accordion>
